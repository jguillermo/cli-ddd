import { BadRequestException, Injectable, NotFoundException } from '@nestjs/common';

@Injectable()
export class <%= className %> {
  constructor(private repository: <%= aggregate.name.value %>Repository) {}

  public async execute(<%= strVoProperties %>): Promise<void> {
    <%_ if (templateRender == "create") { _%>
    const <%= aggregate.name.propertie %> = <%= aggregate.name.value %>.create(<%= strProperties %>);
    await this.repository.persist(<%= aggregate.name.propertie %>);
    <%_ } _%>
    <%_ if (templateRender == "update") { _%>
    const <%= aggregate.name.propertie %> = await this.repository.findById(id);
    if (!<%= aggregate.name.propertie %>) {
    throw new NotFoundException(`<%= aggregate.name.value %> with id ${id} not found`);
    }
    <%= aggregate.name.propertie %>.change(<%= strProperties %>);
    await this.repository.persist(<%= aggregate.name.propertie %>);
    <%_ } _%>
    <%_ if (templateRender == "delete") { _%>
    const <%= aggregate.name.propertie %> = await this.repository.findById(id);
    if (!<%= aggregate.name.propertie %>) {
    throw new NotFoundException(`<%= aggregate.name.value %> with id ${id} not found`);
    }
    repository.delete(<%= aggregate.name.propertie %>);
    <%_ } _%>
    //eventBus.publish(<%= aggregate.name.propertie %>.pullDomainEvents());
  }
}
